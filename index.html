<!DOCTYPE html>
<html>
  <head>
    <title>Rasa Chatbot</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  </head>
  <body>
    <div class="container">
      <h1>Rasa Chatbot</h1>
      <div class="row">
        <div class="col-md-8">
          <div class="card">
            <div class="card-body messages-box">
              <ul class="list-unstyled messages-list">
              </ul>
            </div>
            <div class="card-footer">
              <div class="input-group">
                <input type="text" class="form-control input-message" placeholder="Type something...">
                <div class="input-group-append">
                  <button class="btn btn-primary btn-send">Send</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      var chatSocket = new WebSocket('ws://localhost:5005/websocket');
      chatSocket.onmessage = function(event) {
        var data = JSON.parse(event.data);
        var messagesList = $(".messages-list");
        var messagesBox = $(".messages-box");
        var messageContent = '<li class="clearfix"><div class="message-data text-right"><span class="message-data-time" >' + data.time + '</span> &nbsp; &nbsp;<span class="message-data-name" >Me</span> <i class="fa fa-circle me"></i></div><div class="message other-message float-right">' + data.text + '</div></li>';
        messagesList.append(messageContent);
        messagesBox.scrollTop(messagesBox.prop("scrollHeight"));
      };

      $(".btn-send").click(function(){
        var inputMessage = $(".input-message").val();
        var messagesList = $(".messages-list");
        var messagesBox = $(".messages-box");
        var messageContent = '<li class="clearfix"><div class="message-data"><span class="message-data-name"><i class="fa fa-circle online"></i>Bot</span><span class="message-data-time">' + new Date().toLocaleTimeString() + '</span></div><div class="message my-message">' + inputMessage + '</div></li>';
        messagesList.append(messageContent);
        messagesBox.scrollTop(messagesBox.prop("scrollHeight"));

        chatSocket.send(JSON.stringify({
          'message': inputMessage,
          'sender': 'User'
        }));

        $(".input-message").val("");
      });

      $(".input-message").keypress(function(event) {
        if (event.which == 13) {
          $(".btn-send").click();
        }
      });
    </script>
  </body>
</html>
